# Cybcube test task

## General information
This test task consist of 2 microservices, which communicate with each other via RabbitMQ (in future I will add Apache Kafka also). 
First microservice (supplier) reads persons list from poropeties (filename can be defined in properties file or like environment variable )
In file there is list of persons who will be taked randamly and send via queue to another microservice.

Another microservice (consumer) listen to queue, calculate rating of person, save info to database (postgres) , writes information to console and also write it to cache manager (Redis). 

As I understand from test task, information in redis should be same like it writes to console (no other "technical data" should be present in redis). That is why I decided to save "technical data" to DB. 

## Used technologies and tools

* Java 11
* Cache manager - redis
* Spring cloud steams - Queue manages (supports RabbitMQ, Kafka and some others. Can be easily switch ftom one to another witout changing code (only properties file))
* Postgres
* Gradle
* SpringBoot 2
* Lombok
* Docker
* Docker-compose
* Spring Data JPA
* Some other small spring embedded things

## Supplier microservice API

There are 2 end points in this microservice
* To send custom person to queue
`POST http://localhost:8811/api/persons/sent-person-to-queue`

    Data format:
    ```
    {
      "first_name":"ABC",
      "last_name":"123",
      "age": 44
    }
    ```
* To enable/disable scheduler for sending predefined persons from test-data file.
    
    `GET http://localhost:8811/api/persons/enable-scheduler?enabled=false`
    
    Where `enabled` can be `true` or `false`
    
    If scheduler is enabled, then it begins to send to queue predefined persons from test data.
    Person list can be defined in separate properties file. Name ot this file can be set in properties-file or like environment variable. 
    Scheduler period also can be defined in properties file.

## Sender configuration

* Configurations in `application.properties` file:
    ```
    test-data=classpath:test-data.properties
    scheduler-period=2000
    ```
    * `test-data` is link to test data. See below.
    * `scheduler-period` is period of scheduler sender, to send persons from predefined list.
* Configurations in `test-data.properties` file:
    ```
    test-data.calculation-seed=0.5
    
    test-data.person[2].firstName=Dmitry
    test-data.person[2].lastName=Ivanovich
    test-data.person[2].age=4
    ```
    * `test-data.calculation-seed` is calculation seed from the test task document.
    *  Configurations for predefined persons for scheduler.
        ```
          test-data.person[2].firstName=Dmitry
          test-data.person[2].lastName=Ivanovich
          test-data.person[2].age=4
        ```
        For now there is 7 persons

is the part of the supplier and there are 7 persons in there.

## How to run project

This project can be run in 2 ways:
* With docker-compose
* Like local applications

### Run with docker-compose

Tu run this application with "docker-compose" you need just run the command :

`docker-compose up -d`

Yon do not need even to have Java installed on your local computer, because compilation of the source code take place inside docker images.
Docker-compose will start those docker images needed for this project :
* consumer
* redis-commander
* supplier
* rabbitmq
* redis
* postgres

### Run like local applications

Before run (consumer) and (supplier) applications, you need provide environment for them:

supplier needs :

* rabbitmq (localhost:5672)

consumer needs:

* rabbitmq (localhost:5672)
* postgres (localhost:5432; password=postgres; username=postgres)
* redis (localhost:6379)

You can run all this applications by yourself with this data, or you can just run command :

`docker-compose up -d postgres redis-commander rabbitmq consumer`

And all needed containers will start automatically for you.
After that you can just run **consumer** and **supplier** like normal SpringBoot applications.

### See the results

It is 2 ways to see result data generated by this project:
* In console -- **consumer** writes to console calculated rating of each person in format like it was pointed in task description:
`"<firstName> <lastName> has <socialRatingScore> score"`

* In Redis UI - "redis-commander"  -- You need to type in browser this address : `localhost:8813` and You will see all persons data cached by redis. Where key is `<firstName> <lastName>` and values is `score`

### TODO

* WRITE TESTS !!!!
* Add Apache Kafka queue to work together with RabbitMQ or add choice you user which queue he/she wants. (should be easy because of **spring cloud streams**)
* Clarify task, make sure that everything works like it written in test task document
* Look through all code to make shure that there are not any errors or garbage code. Also check code formating.
* Read this text,  fix grammatical errors. 
* Write help files to **supplier** microservice and **consumer** microservice.
